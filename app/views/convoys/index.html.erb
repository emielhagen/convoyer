<%= form_tag convoys_path, method: :get do %>
  <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "Find a convoy" %>
<% end %>

<div class="container">
  <% @convoys.each do |convoy| %>
    <div class="card card__convoy">
      <div class="card__text">

      <p>Name: <%= convoy.name%></p>
      <p>Start at: <%= convoy.start_date.strftime("%d-%m-%Y")%></p>
      <p>Arrive at: <%= convoy.finish_date.strftime("%d-%m-%Y")%></p>
      <p>4WD only: <%= convoy.fwd_only%></p>
      <p>Started by: <%= convoy.user.name%></p>
      <p>From: <%= convoy.from_location.name %></p>
      <p>To: <%=convoy.to_location.name  %></p>
      <div data-convoy-id="<%= convoy.id %>" class="convoy-heart-icon">
        <%= render 'heart', convoy: convoy %>
      </div>
      <p><%= link_to 'Details', convoy_path(convoy) %></p>
      <% if convoy.user_id == current_user.id %>
        <p><%= link_to 'Edit', edit_convoy_path(convoy) %></p>
        <p> <%= link_to 'Delete', convoy_path(convoy), method: :delete, data: { confirm: "Are you sure?" } %></p>
      <% end %>
      </div>
      <div class="card__image">
        <%= cl_image_tag("https://images.unsplash.com/photo-1489993360877-883980cc7333?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1500&q=80") %>
      </div>
    </div>
  <% end %>
</div>

<% if policy(Convoy).create? %>
  <%= link_to 'Start a convoy!', new_convoy_path, class: 'btn btn-success' %>
<% end %>
